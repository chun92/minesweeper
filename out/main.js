import initSync from"./minesweeper.js";import{FIREBASECONFIG}from"./firebaseConfig.js";const encodedValue=FIREBASECONFIG,decodedString=atob(encodedValue),firebaseConfig=JSON.parse(decodedString),app=firebase.initializeApp(firebaseConfig),db=firebase.firestore(app);async function main(){try{await initSync()}catch(e){console.error("Error in initSync:",e)}finally{document.getElementById("loader").remove()}}function isValidObject(e){const n="string"==typeof e.id,o="number"==typeof e.time,r="string"==typeof e.difficulty,t=e.created_at&&"function"==typeof e.created_at.toDate;return n&&o&&r&&t}window.addEventListener("contextmenu",function(e){e.preventDefault()},!1),window.listen_login_js=function(e){return new Promise((n,o)=>{const r=db.collection("login").doc(e).onSnapshot(e=>{if(e.exists){const o=e.data().user_id;console.log("User ID from updated document:",o),r(),n(o)}else console.log("Document does not exist yet.")},e=>{console.error("Error listening to document:",e),r(),o(new Error("Error listening to document"))})})},window.add_ranking_js=function(e,n,o){return new Promise((r,t)=>{try{db.collection("ranking").add({id:e,time:n,difficulty:o,created_at:firebase.firestore.FieldValue.serverTimestamp()}),r()}catch(e){console.error("Error adding document: ",e),t(new Error("Error adding document"))}})},window.read_ranking_js=function(){return new Promise((e,n)=>{const o=[];try{db.collection("ranking").get().then(n=>{n.forEach(e=>{const n=e.data(),r=Math.floor(Date.now()/1e3);if(!isValidObject(n))return void console.error("Invalid object:",n);const t={id:n.id,time:n.time,difficulty:n.difficulty,created_at:n.created_at?n.created_at.seconds:r};o.push(t)}),e(o)})}catch(e){console.error("Error read document: ",e),n(new Error("Error read document"))}})},main();